<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Practice Passages Information - ETA v13H</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 font-sans">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
      <h1 class="text-3xl font-bold text-center mb-8">
        üìÅ Practice Passages Information
      </h1>

      <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
        <h2 class="text-lg font-semibold text-blue-800 mb-2">
          üîß Implementation Status
        </h2>
        <p class="text-blue-700">
          Practice passages are now loaded and displayed in the dropdown on
          <a href="show-scales.html" class="underline">show-scales.html</a>. The
          passages are loaded from JSON files and can be selected, but rendering
          functionality is not yet implemented.
        </p>
      </div>

      <div id="passages-container" class="space-y-6">
        <!-- Practice passages will be loaded here -->
      </div>

      <div class="text-center mt-8">
        <a
          href="index.html"
          class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition mr-4"
        >
          ‚¨Ö Home
        </a>
        <a
          href="show-scales.html"
          class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition"
        >
          üéº Show Scales (with Practice Passages)
        </a>
      </div>
    </div>

    <!-- Include CMT Converter -->
    <script src="scripts/cmtConverter.js"></script>

    <script>
      // Load and display practice passage information
      const passageFiles = [
        "danny-boy.json",
        "king-of-the-road.json",
        "twinkle-twinkle-little-star.json",
      ];

      async function loadAndDisplayPassages() {
        const container = document.getElementById("passages-container");

        for (const filename of passageFiles) {
          try {
            const response = await fetch(`practicePassages/${filename}`);
            if (!response.ok) {
              console.warn(`Could not load ${filename}`);
              continue;
            }

            const passage = await response.json();

            // Create display card
            const card = document.createElement("div");
            card.className = "bg-white p-6 rounded-lg shadow-md border";

            // Count total notes
            const totalNotes = passage.measures.reduce((count, measure) => {
              return (
                count +
                measure.notes.filter((note) => note.pitch !== "rest").length
              );
            }, 0);

            // Get unique pitches
            const uniquePitches = new Set();
            passage.measures.forEach((measure) => {
              measure.notes.forEach((note) => {
                if (note.pitch !== "rest") {
                  uniquePitches.add(note.pitch);
                }
              });
            });

            card.innerHTML = `
                        <h3 class="text-xl font-bold mb-3">${passage.title}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <p><strong>Filename:</strong> ${filename}</p>
                                <p><strong>Key Signature:</strong> ${
                                  passage.keySignature
                                }</p>
                                <p><strong>Time Signature:</strong> ${
                                  passage.timeSignature
                                }</p>
                                <p><strong>Clef:</strong> ${passage.clef}</p>
                                ${
                                  passage.composer
                                    ? `<p><strong>Composer:</strong> ${passage.composer}</p>`
                                    : ""
                                }
                            </div>
                            <div>
                                <p><strong>Total Measures:</strong> ${
                                  passage.measures.length
                                }</p>
                                <p><strong>Total Notes:</strong> ${totalNotes}</p>
                                <p><strong>Unique Pitches:</strong> ${
                                  uniquePitches.size
                                }</p>
                                <p><strong>Has Lyrics:</strong> ${
                                  passage.measures.some((m) =>
                                    m.notes.some((n) => n.lyric)
                                  )
                                    ? "Yes"
                                    : "No"
                                }</p>
                            </div>
                        </div>
                        
                        <details class="mb-4">
                            <summary class="cursor-pointer font-semibold text-gray-700 hover:text-gray-900">View Pitch Sequence</summary>
                            <div class="mt-2 space-y-3">
                                <div>
                                    <div class="font-semibold text-blue-800 mb-2">üìù CMT Format (Full Sequence):</div>
                                    <div class="p-3 bg-blue-50 border border-blue-200 rounded text-sm font-mono whitespace-pre-line">${
                                      window.convertPassageToCMT
                                        ? window.convertPassageToCMT(passage, {
                                            includeMeasureMarkers: true,
                                            tokensPerLine: 6,
                                          })
                                        : "CMT converter not loaded"
                                    }</div>
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-700 mb-2">üéµ Unique Pitches Used:</div>
                                    <div class="p-3 bg-gray-50 rounded text-sm font-mono">${
                                      window.getUniquePitches
                                        ? window
                                            .getUniquePitches(passage)
                                            .join(", ")
                                        : Array.from(uniquePitches)
                                            .sort()
                                            .join(", ")
                                    }</div>
                                </div>
                            </div>
                        </details>
                        
                        <details>
                            <summary class="cursor-pointer font-semibold text-gray-700 hover:text-gray-900">View Raw JSON Structure</summary>
                            <div class="mt-2 p-3 bg-gray-50 rounded text-xs font-mono overflow-x-auto">
                                <pre>${JSON.stringify(passage, null, 2)}</pre>
                            </div>
                        </details>
                    `;

            container.appendChild(card);
          } catch (error) {
            console.error(`Error loading ${filename}:`, error);
          }
        }
      }

      // Load passages when page loads
      document.addEventListener("DOMContentLoaded", loadAndDisplayPassages);
    </script>
  </body>
</html>
